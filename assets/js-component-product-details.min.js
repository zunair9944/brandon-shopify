(()=>{class t extends HTMLElement{constructor(){super(),this.elProductForm=this.querySelector("[data-product-form]"),this.elsOption=this.querySelectorAll("[data-product-option]"),this.elBisModal=document.querySelector(this.getAttribute("data-bis-modal")),this.addEventListener("change",this.onVariantChange),this.updateOptions(),this.updateMasterId(),this.updateOptionsAvailability()}onVariantChange(){this.updateOptions(),this.updateMasterId(),this.updateOptionsAvailability(),this.currentVariant&&(this.updateURL(),this.updateSelectedIndex(),this.renderProductInfo(),this.changeBisModal())}changeBisModal(){if(!this.elBisModal)return;const t=this.elBisModal.querySelector("[name='variant']");t&&("SELECT"===t.tagName?t.selectedIndex=Array.from(t.querySelectorAll("option")).findIndex((t=>t.value==this.currentVariant.id)):t.value=this.currentVariant.id,t.dispatchEvent(new Event("change")))}updateOptionsAvailability(){const t=this.variantData.filter((t=>!t.available&&(!(!t.option3||!t.options.includes(this.currentVariant?.option2))||(!(t.option3||!t.options.includes(this.currentVariant?.option1))||void 0)))).map((t=>{const e=t.option3?2:1;return t.options.slice(e,3)})).flat();this.getOptionEls().forEach((e=>{e.removeAttribute("data-disabled"),t.includes(e.value)&&e.setAttribute("data-disabled",!0)}))}updateOptions(){this.options=Array.from(this.getOptionEls(!0),(t=>t.value))}getOptionEls(t=!1){return this.querySelectorAll("[data-product-option]"+(t?":checked":""))}updateMasterId(){this.currentVariant=this.getVariantData().find((t=>!t.options.map(((t,e)=>this.options[e]===t)).includes(!1)))}updateURL(){this.currentVariant&&"false"!==this.dataset.updateUrl&&window.history.replaceState({},"",`${this.dataset.url}?variant=${this.currentVariant.id}`)}updateSelectedIndex(){const t=this.elProductForm.querySelector("select[name='id']");t.selectedIndex=this.variantData.findIndex((t=>t.id===this.currentVariant.id)),t.dispatchEvent(new Event("change",{bubbles:!1}))}renderProductInfo(){this.setAttribute("loading",!0),fetch(`${this.dataset.url}?variant=${this.currentVariant.id}&section_id=${this.dataset.section}`).then((t=>t.text())).then((t=>{const e=(new DOMParser).parseFromString(t,"text/html"),a=!!e.querySelector("[data-sold-out]");this.classList.toggle("product-section__details--soldout",a),document.querySelectorAll("[data-dynamic]").forEach((t=>{this.replaceContent(t,e.querySelector(`[data-dynamic="${t.getAttribute("data-dynamic")}"]`))}))})).finally((()=>this.removeAttribute("loading")))}replaceContent(t,e){t&&e&&(t.innerHTML=e.innerHTML)}getVariantData(){return this.variantData=this.variantData||JSON.parse(this.querySelector("[type='application/json']").textContent),this.variantData}}customElements.define("product-details",t)})();