(()=>{class t extends HTMLElement{constructor(){super(),this.elForm=this.querySelector("form"),this.elSubmitBtn=this.elForm.querySelector("button[type='submit']"),this.elEmailInput=this.elForm.querySelector("input[type='email']"),this.elMainInput=this.elEmailInput,this.elNewsletterWrapper=this.elForm.querySelector("[data-newsletter-form]"),this.elForm.addEventListener("submit",this.onSubmit.bind(this)),this.initKlaviyoForm()}onSubmit(t){t.preventDefault();const e=new FormData(this.elForm);"on"===e.get("subscribe")&&this.subscribeEmailList(),e.set("email",this.elMainInput.value),e.delete("subscribe"),this.elForm.setAttribute("loading",!0),fetch("https://a.klaviyo.com/onsite/components/back-in-stock/subscribe",{method:"POST",body:e}).then((t=>t.json())).then((t=>{t.success?this.onSuccess():this.onError()})).catch(this.onError).finally((()=>this.elForm.removeAttribute("loading")))}onSuccess(){this.elSubmitBtn.classList.add("backinstock-block__button--success")}onError(){this.elSubmitBtn.classList.add("backinstock-block__button--error")}subscribeEmailList(){this.elKlaviyoForm&&this.elKlaviyoForm.querySelectorAll("button").forEach((t=>t.click()))}async initKlaviyoForm(){if(!this.elNewsletterWrapper)return void this.elForm.removeAttribute("loading");const t=await this.waitForEl("form",this.elNewsletterWrapper);if(this.elForm.removeAttribute("loading"),t){this.elForm.querySelector("input[name='subscribe']").parentElement.removeAttribute("hidden"),this.elKlaviyoForm=t,this.elKlaviyoInput=this.elKlaviyoForm.querySelector("input[type='email']");try{const t=this.elEmailInput.nextElementSibling.cloneNode(!0);this.elKlaviyoInput.classList.add("backinstock-block__form-field"),this.elKlaviyoInput.setAttribute("placeholder",this.elEmailInput.getAttribute("placeholder")),this.elKlaviyoInput.setAttribute("required",!0),this.elKlaviyoInput.insertAdjacentElement("afterend",t),this.elEmailInput.removeAttribute("required"),this.elNewsletterWrapper.removeAttribute("hidden"),this.elNewsletterWrapper.querySelector("button").parentElement.setAttribute("hidden",!0),this.elMainInput=this.elKlaviyoInput}catch(t){this.elNewsletterWrapper.setAttribute("hidden"),this.elMainInput=this.elEmailInput}}}waitForEl(t,e=this){return new Promise((i=>{if(e.querySelector(t))return i(e.querySelector(t));const r=new MutationObserver((()=>{e.querySelector(t)&&(i(e.querySelector(t)),r.disconnect())}));r.observe(this,{childList:!0,subtree:!0})}))}}customElements.define("backinstock-block",t)})(); 